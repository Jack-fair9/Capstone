<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Employee Login - Needle</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    
    .container {
      width: 400px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      padding: 40px;
    }
    
    h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: #4a6fa5;
      text-align: center;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    input {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      transition: border 0.3s;
    }
    
    input:focus {
      border-color: #4a6fa5;
      outline: none;
    }
    
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 5px;
      background-color: #4a6fa5;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    button:hover {
      background-color: #3a5a80;
    }
    
    .secondary-btn {
      background-color: #f0f0f0;
      color: #4a6fa5;
      margin-top: 10px;
    }
    
    .secondary-btn:hover {
      background-color: #e0e0e0;
    }
    
    .message {
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 5px;
      display: none;
    }
    
    .error {
      background-color: #ffebee;
      color: #c62828;
    }
    
    .success {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    
    .forgot-password {
      text-align: right;
      margin-bottom: 20px;
    }
    
    .forgot-password a {
      color: #4a6fa5;
      text-decoration: none;
      font-size: 14px;
    }
    
    .forgot-password a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Employee Login</h1>
    <div id="loginMessage" class="message"></div>
    
    <form id="loginForm">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Enter your email" required>
      </div>
      
      <div class="form-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter your password" required>
      </div>
      
      <div class="forgot-password">
        <a href="forget.html" onclick="showForgotPassword()">Forgot Password?</a>
      </div>
      
      <button type="button" onclick="handleLogin()">Login</button>
      <button type="button" class="secondary-btn" onclick="window.location.href='employeeregister.html'">Create New Account</button>
    </form>
    
    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" style="display: none; margin-top: 20px;">
      <h3>Reset Password</h3>
      <div class="form-group">
        <label for="resetEmail">Email</label>
        <input type="email" id="resetEmail" placeholder="Enter your email" required>
      </div>
      <button type="button" onclick="handlePasswordReset()">Send Reset Link</button>
      <button type="button" class="secondary-btn" onclick="hideForgotPassword()">Cancel</button>
    </div>
  </div>

  <script>
    function showMessage(message, isError) {
      const msgElement = document.getElementById('loginMessage');
      msgElement.textContent = message;
      msgElement.className = isError ? 'message error' : 'message success';
      msgElement.style.display = 'block';
      
      if (isError) {
        setTimeout(() => {
          msgElement.style.display = 'none';
        }, 5000);
      }
    }

    function showForgotPassword() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('forgotPasswordModal').style.display = 'block';
      document.getElementById('resetEmail').value = document.getElementById('email').value;
    }

    function hideForgotPassword() {
      document.getElementById('loginForm').style.display = 'block';
      document.getElementById('forgotPasswordModal').style.display = 'none';
    }

    async function handlePasswordReset() {
      const email = document.getElementById('resetEmail').value.trim();
      
      if (!email) {
        showMessage('Please enter your email address', true);
        return;
      }

      try {
        showMessage('Sending password reset instructions...', false);
        
        const response = await fetch('http://localhost:3000/forgot-password', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            email: email,
            userType: 'employee'
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || 'Failed to send reset link');
        }

        showMessage('Password reset instructions sent to your email', false);
        hideForgotPassword();
      } catch (error) {
        console.error('Password reset error:', error);
        showMessage(error.message || 'Failed to send reset link. Please try again.', true);
      }
    }

    async function handleLogin() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      
      if (!email || !password) {
        showMessage('Please enter both email and password', true);
        return;
      }

      try {
        showMessage('Logging in...', false);
        
        const response = await fetch('http://localhost:3000/api/employees/login', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            email: email,
            password: password
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || 'Login failed');
        }

        if (!data.employee || !data.employee._id) {
          throw new Error('Incomplete employee data received');
        }

        showMessage('Login successful! Redirecting...', false);
        
        // Store ALL employee data
        localStorage.setItem('employeeToken', data.token);
        localStorage.setItem('employeeData', JSON.stringify(data.employee));
        
        // Redirect to dashboard
        setTimeout(() => {
          window.location.href = `employeec.html?id=${data.employee._id}`;
        }, 1500);
      } catch (error) {
        console.error('Login error:', error);
        showMessage(error.message || 'Login failed. Please try again.', true);
      }
    }

    // Add keyboard support for Enter key
    document.addEventListener('keypress', function(event) {
      if (event.key === 'Enter' && document.getElementById('loginForm').style.display !== 'none') {
        handleLogin();
      }
      else if (event.key === 'Enter' && document.getElementById('forgotPasswordModal').style.display === 'block') {
        handlePasswordReset();
      }
    });
  </script>
</body>
</html>